/**
 * åœ¨çµå¸³é  LINE ç™»å…¥æŒ‰éˆ•ä¸‹æ–¹åŠ å…¥èªªæ˜æ¡†
 * ä½¿ç”¨ JavaScript å‹•æ…‹æ’å…¥
 * ç‰ˆæœ¬ 2.4 - æ‰‹æ©Ÿç‰ˆå­—é«”å†åŠ å¤§ï¼Œèˆ‡ç¬¬ä¸€å€‹æç¤ºæ¡†çµ±ä¸€
 */

add_action( 'wp_footer', 'bcongee_line_login_benefits_box' );

function bcongee_line_login_benefits_box() {
    
    // åªåœ¨çµå¸³é é¢åŸ·è¡Œ
    if ( ! is_checkout() ) {
        return;
    }
    
    // å¦‚æœå·²ç™»å…¥å°±ä¸é¡¯ç¤º
    if ( is_user_logged_in() ) {
        return;
    }
    
    ?>
    <script>
    jQuery(document).ready(function($) {
        
        // å»¶é²åŸ·è¡Œï¼Œç¢ºä¿ DOM å®Œå…¨è¼‰å…¥
        setTimeout(function() {
            
            // å°‹æ‰¾ç¶ è‰² LINE ç™»å…¥æŒ‰éˆ•
            var lineButton = $(
                '.line-login-btn, ' +
                'a[class*="line"], ' +
                'button[class*="line"], ' +
                'a:contains("ç™»å…¥")[href*="line"], ' +
                '.woocommerce-form-login-toggle + a, ' +
                'a[style*="background"][style*="00B900"]'
            ).filter(function() {
                var text = $(this).text().toLowerCase();
                var href = $(this).attr('href') || '';
                return $(this).is(':visible') && 
                       (text.includes('line') || 
                        text.includes('ç™»å…¥') || 
                        href.includes('line'));
            }).first();
            
            // å¦‚æœæ‰¾åˆ°æŒ‰éˆ•ï¼Œä¸”é‚„æ²’åŠ éèªªæ˜æ¡†
            if (lineButton.length > 0 && lineButton.next('.bcongee-line-benefits-box').length === 0) {
                
                // å»ºç«‹èªªæ˜æ¡† HTML
                var benefitsBox = `
                    <div class="bcongee-line-benefits-box">
                        <div class="bcongee-benefits-title">
                            âš¡ ä¸€éµå®Œæˆï¼Œè¶…ç´šç°¡å–®
                        </div>
                        
                        <div class="bcongee-benefits-content">
                            <div class="benefit-text">åªè¦é»æ“Šä¸Šæ–¹ç¶ è‰²æŒ‰éˆ•ï¼ŒåŒæ„æˆæ¬Šå³å¯ï¼</div>
                            <div class="benefit-text">ä¹‹å¾Œæ‰€æœ‰è¨‚å–®é€šçŸ¥éƒ½æœƒè‡ªå‹•æ¨æ’­åˆ°æ‚¨çš„ LINE</div>
                            <div class="benefit-text">å®Œå…¨ä¸éœ€è¦å¦å¤–è¨­å®šï¼Œéå¸¸æ–¹ä¾¿ ğŸ˜Š</div>
                        </div>
                    </div>
                `;
                
                // åœ¨æŒ‰éˆ•å¾Œé¢æ’å…¥èªªæ˜æ¡†
                lineButton.after(benefitsBox);
            }
            
        }, 500);
        
    });
    </script>
    
    <style>
    /* èªªæ˜æ¡†å®¹å™¨ */
    .bcongee-line-benefits-box {
        margin: 15px 0 20px 0;
        padding: 16px 18px;
        background: #F8F9FA;
        border-radius: 8px;
        border: 1px solid #E0E0E0;
        text-align: center;
    }
    
    /* æ¨™é¡Œ - æ¡Œé¢ç‰ˆ */
    .bcongee-benefits-title {
        color: #27AE60;
        font-weight: bold;
        margin-bottom: 12px;
        font-size: 17px; /* åŠ å¤§ï¼ */
    }
    
    /* å…§å®¹å®¹å™¨ */
    .bcongee-benefits-content {
        text-align: left;
    }
    
    /* æ¯ä¸€è¡Œæ–‡å­— - æ¡Œé¢ç‰ˆ */
    .benefit-text {
        font-size: 16px; /* åŠ å¤§ï¼ */
        color: #333; /* æ·±è‰² */
        font-weight: 500; /* ç¨å¾®åŠ ç²— */
        line-height: 1.7;
        margin-bottom: 8px;
    }
    
    .benefit-text:last-child {
        margin-bottom: 0;
    }
    
    /* æ‰‹æ©Ÿç‰ˆå„ªåŒ– - é‡é»ï¼å­—é«”å†åŠ å¤§ */
    @media (max-width: 768px) {
        .bcongee-line-benefits-box {
            margin: 12px 0 18px 0 !important;
            padding: 14px 16px !important;
        }
        
        /* æ¨™é¡Œå¤§å¹…åŠ å¤§ - èˆ‡ç¬¬ä¸€å€‹æç¤ºæ¡†çµ±ä¸€ */
        .bcongee-benefits-title {
            font-size: 19px !important; /* å†åŠ å¤§ï¼åŸæœ¬ 17px */
            margin-bottom: 10px !important;
            font-weight: bold !important;
        }
        
        /* å…§å®¹æ–‡å­—å¤§å¹…åŠ å¤§ - èˆ‡ç¬¬ä¸€å€‹æç¤ºæ¡†çµ±ä¸€ */
        .benefit-text {
            font-size: 16px !important; /* ä¿æŒ 16pxï¼Œèˆ‡ä¸Šæ–¹æç¤ºæ¡†ä¸€è‡´ */
            line-height: 1.6 !important;
            margin-bottom: 6px !important;
            color: #1f2d3d !important; /* æ›´æ·±è‰² */
            font-weight: 600 !important; /* æ›´ç²— */
        }
    }
    </style>
    <?php
}
